<!DOCTYPE html>
<html lang="en">
<head>
    

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>How To Create a Serverless Node.js App with DynamoDB For The First Time &#8211; Effortless Serverless</title>
   
    <link rel="dns-prefetch" href="//maxcdn.bootstrapcdn.com">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="description" content="Effortless Serverless. Checkout our new book: Serverless apps with Node.js and Claudia">
    <meta name="robots" content="all">
    
    <meta name="author" content="Aleksandar Simović and Slobodan Stojanović">
    
    <meta property="fb:pages" content="ServerlessAppsWithNodeAndClaudiajs" />
    <meta name="keywords" content="serverless, lambda, dynamodb">
    
    <link rel="canonical" href="https://effortless-serverless.com/serverless/lambda/dynamodb/2017/10/19/serverless-icecream-database/">
    
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for Effortless Serverless" href="/feed.xml" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css?201803291748" type="text/css">

    <!-- Fonts -->
    
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic&amp;subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300&amp;subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    
    
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    

    <!-- Verifications -->
    
      <meta name="google-site-verification" content="Wm_B41Fjq5RPten2R24t7vffMFKohk59QjKBr9HW1lY" />
    
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">

    <meta property="og:site_name" content="Effortless Serverless">
    
    <meta property="og:title" content="How To Create a Serverless Node.js App with DynamoDB For The First Time">
    <meta property="og:type" content="article">
    <meta property="og:description" content="There are many articles on serverless with explained ideas, benefits and so on. Serverless is great, but articles sometimes sound more like a TV commercial.

" />
    <meta name="twitter:title" content="How To Create a Serverless Node.js App with DynamoDB For The First Time"/>
    <meta name="twitter:description" content="There are many articles on serverless with explained ideas, benefits and so on. Serverless is great, but articles sometimes sound more like a TV commercial.

" />
    

    <meta property="og:url" content="https://effortless-serverless.com/serverless/lambda/dynamodb/2017/10/19/serverless-icecream-database/">
    <meta name="twitter:url" content="https://effortless-serverless.com/serverless/lambda/dynamodb/2017/10/19/serverless-icecream-database/" />

     
    <meta property="article:published_time" content="2017-10-19T12:00:00+02:00">
    
    <meta property="article:author" content="https://effortless-serverless.com/about/">
    
    <meta itemprop="keywords" content="" />
    
    
    
    
    <meta property="og:image" content="https://effortless-serverless.com/images/effortless-serverless-social.png">
    <meta name="twitter:image" content="https://effortless-serverless.com/images/effortless-serverless-social.png" />
    

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png">

    <link rel="manifest" href="/manifest.json">

    <meta name="theme-color" content="#3399FF" />

    
    <script type="text/javascript">
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
       ga('create', 'UA-107409591-1', 'auto');
       ga('send', 'pageview');
    </script>
    
</head>

<body class="site">
  
	

  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="/" class="site-title">Effortless Serverless</a>
      <nav class="site-nav">
        



    
    
    
    
        <a href="/about/">About</a>
    

    

    
    
    
    
        <a href="/book/">Book</a>
    

    

    
    
    
    
        <a href="/conferences/">Conferences</a>
    

    

    
    
    
    
        <a href="/projects/">Projects</a>
    

    


      </nav>
      <div class="clearfix"></div>
      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        


<div class="post-header mb2">
  <h1>How To Create a Serverless Node.js App with DynamoDB For The First Time</h1>
  <span class="post-meta">Oct 19, 2017</span><br>
  
  <span class="post-meta small">
  
    6 minute read
  
  </span>
</div>

<article class="post-content">
  <p>There are many articles on serverless with explained ideas, benefits and so on. Serverless is great, but articles sometimes sound more like a TV commercial.</p>

<p>Sometimes you just want to try and create a working example.</p>

<blockquote>
  <p>Serverless is like ice cream. It’s nice to talk about it, but much better to try out.</p>
</blockquote>

<p><img src="/images/serverless-icecream.jpg" alt="" /></p>

<p>The goal is to show how to create a serverless Node.js app with DynamoDB that stores and retrieves data.
Since ice creams are already mentioned, this service will be for an ice cream shop. You will save and show ice creams.</p>

<p>Let’s first see what do you need:</p>

<ul>
  <li>
    <p><strong>a serverless host</strong> — where you’re going to deploy and execute your code and connect to a database. We’re going with AWS, as the most mature platform at the moment.
 AWS has a serverless container service called Lambda. Because Lambda is just a compute service without “outside access”, we also need an “access point” or a “front door” service — AWS API Gateway.</p>
  </li>
  <li>
    <p><strong>a development and deployment tool / library</strong> — helps with code setup and deployment. Because serverless is still new and these tools make your life easier. Choosing a library influences the way you build your services. We’re going to use Claudia.js - a development and deployment tool with helpful examples and a good community. It will deploy your service to your AWS serverless container (Lambda) and create an API Gateway for it.</p>
  </li>
  <li>
    <p><strong>a service</strong> — your service that receives a request,  saves an ice cream to a database or shows all ice creams you saved.</p>
  </li>
  <li>
    <p><strong>a database</strong> — a storage to which you connect your service to store ice creams. We’re going with DynamoDB — AWS noSQL database.</p>
  </li>
</ul>

<p><img src="/images/serverless-icecream-overview.png" alt="The overview of your service infrastructure" /></p>

<h3 id="1-serverless-host-setupaws">1. Serverless host setup — AWS</h3>

<p>You need to have an AWS account and a locally set AWS credentials file.</p>

<p><em>If you already have both setup, scroll to section 2.</em></p>

<p>If not, open your browser and go to — <a href="https://console.aws.amazon.com">https://console.aws.amazon.com</a>.</p>

<p>If you don’t have an AWS account, click on the button <em>“Create a new AWS account”</em> and follow the process. </p>

<p>If you do, you only need to set your AWS credentials. To do it:</p>

<ol>
  <li>
    <p>Open AWS Console, click on <em>“Services”</em> in the top navigation bar. Write IAM in the search box and click on the resulted IAM.</p>
  </li>
  <li>
    <p>Click on “Users” on the left side menu, then “Add User”. You will see the following picture.</p>

    <p><img src="/images/serverless-icecream-user.png" alt="" />
 There you need to type in the user name and check the programmatic access. Then click the button “Next: Permissions”.</p>
  </li>
  <li>
    <p>You will be on the 2nd step. Now click the “Attach existing policies directly” and then check “Administrator Full Access”. Proceed to the 3rd step “Review”, and then click the “Create user” for the 4th step. 
At the last (4th) step, you will see a table with your user name and columns with your user’s “Access Key Id” and “Secret Access Key Id”. Copy those values.</p>
  </li>
  <li>
    <p>Add those keys  to your .aws/credentials file.</p>

    <p>a) On OSX/*nix in — <code class="highlighter-rouge">~/.aws</code></p>

    <p>b) On Win its  — <code class="highlighter-rouge">C:/Users/&lt;your-user&gt;/.aws</code></p>

    <div class="language-shell highlighter-rouge"><pre class="highlight"><code> <span class="o">[</span>default]
 aws_access_key_id <span class="o">=</span> YOUR_ACCESS_KEY
 aws_secret_access_key <span class="o">=</span> YOUR_ACCESS_SECRET
</code></pre>
    </div>
    <p>Set the AWS_PROFILE environment variable to default.</p>
  </li>
</ol>

<h3 id="2-setup-your-development-and-deployment-toolclaudiajs">2. Setup your development and deployment tool — Claudia.js</h3>

<p><em>If you have Claudia.js installed already scroll to section 3.</em></p>

<p>Open your terminal and run:</p>

<p><code class="highlighter-rouge">npm install -g claudia</code></p>

<p>Claudia.js is now installed globally, available for all projects.</p>

<h3 id="3-write-your-serviceice-creamshop">3. Write your service — Ice Cream Shop</h3>

<p>Create your project folder (you can name it <code class="highlighter-rouge">ice-cream-shop</code>) and open it in your terminal. </p>

<p>Initialize your Node project.</p>

<p><em>You can do it quickly by running</em> <code class="highlighter-rouge">npm init -f</code></p>

<p>Then run</p>
<div class="language-shell highlighter-rouge"><pre class="highlight"><code> npm install aws-sdk claudia-api-builder -S 
</code></pre>
</div>

<p>This installs AWS SDK and Claudia API Builder. You need AWS SDK for accessing DynamoDB. Claudia API Builder is a helper tool with an Express-like syntax for your endpoints.</p>

<p>Your service needs to have two endpoints:</p>

<ol>
  <li>
    <p>to save an icecream — needs a POST request</p>
  </li>
  <li>
    <p>to get all saved ice creams — needs a GET request</p>
  </li>
</ol>

<p>Now create an empty index.js file. Open it and type:</p>

<script src="https://gist.github.com/simalexan/528f4842f4f3be3804af9512c27550a6.js"></script>

<p>This finishes your service.</p>

<h3 id="4-databasesetupdynamodb">4. Database — setup DynamoDB</h3>

<p>You need to create a database on AWS, but instead of using AWS Console, you can just execute one command:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>aws dynamodb create-table --table-name icecreams <span class="se">\</span>
  --attribute-definitions <span class="nv">AttributeName</span><span class="o">=</span>icecreamid,AttributeType<span class="o">=</span>S <span class="se">\</span>
  --key-schema <span class="nv">AttributeName</span><span class="o">=</span>icecreamid,KeyType<span class="o">=</span>HASH <span class="se">\</span>
  --provisioned-throughput <span class="nv">ReadCapacityUnits</span><span class="o">=</span>1,WriteCapacityUnits<span class="o">=</span>1 <span class="se">\</span>
  --region us-east-1 <span class="se">\</span>
  --query TableDescription.TableArn --output text
</code></pre>
</div>

<p>This command creates a DynamoDB table named <code class="highlighter-rouge">icecreams</code> in the same region as our Lambda, with an key attribute <code class="highlighter-rouge">icecreamid</code> of String type. The command returns the table’s Amazon Resource Name (ARN) to confirm that everything is set up correctly.</p>

<h4 id="giving-your-service-permission-for-thedatabase">Giving your service permission for the database</h4>

<p>The last step is allowing your service access to your DynamoDb database. To do that your service requires a permission policy. Instead of doing it via AWS Console, you can create a policy file in your project and apply it with Claudia.</p>

<p>Inside your ice-cream-shop project folder create a folder named <code class="highlighter-rouge">policy</code> and in it a file called <code class="highlighter-rouge">dynamodb-policy.json</code> with the following contents:</p>

<script src="https://gist.github.com/simalexan/5e7bff9eb50cd392c715407ad1682b10.js"></script>

<p><em>If copying from here, be sure the code stays with the same spacing. JSON must keep a proper structure.</em></p>

<p>This policy allows your Lambda service to access your DynamoDb database. When invoking Claudia to deploy your code, this policy file location needs to be passed as the command option, to let Claudia know to assign the policy to your Lambda.</p>

<p>It’s time for your first deployment. In the first, Claudia.js creates a Lambda for your service. So, go back to your project folder <code class="highlighter-rouge">ice-cream-shop</code> and run:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>claudia create --region us-east-1 --api-module index --policies policy
</code></pre>
</div>

<p>This command creates your serverless container (AWS Lambda) in the <code class="highlighter-rouge">us-east-1</code> region, sets the <code class="highlighter-rouge">index</code> file as the main, and assigns the policy from the <code class="highlighter-rouge">policy</code> folder to your Lambda. If successful, it returns the created service URL endpoint in the command final output similar to this:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="o">{</span>
  <span class="s2">"lambda"</span>: <span class="o">{</span>
    <span class="s2">"role"</span>: <span class="s2">"ice-cream-shop-executor"</span>,
    <span class="s2">"name"</span>: <span class="s2">"ice-cream-shop"</span>,
    <span class="s2">"region"</span>: <span class="s2">"us-east-1"</span>
  <span class="o">}</span>,
  <span class="s2">"api"</span>: <span class="o">{</span>
    <span class="s2">"id"</span>: <span class="s2">"your-service-id"</span>,
    <span class="s2">"module"</span>: <span class="s2">"index"</span>,
    <span class="s2">"url"</span>: <span class="s2">"https://your-service-url.execute-api.us-east-1.amazonaws.com/latest"</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>That’s it! </p>

<h4 id="trying-out-yourservice">Trying out your service</h4>

<p>Use cURL for testing. Get all ice creams:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>curl https://your-service-url.execute-api.us-east-1.amazonaws.com/latest/icecreams
</code></pre>
</div>

<p>Save an ice cream:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>curl -H <span class="s2">"Content-Type: application/json"</span> -X POST <span class="se">\</span>
-d <span class="s1">'{"icecreamId":"123", "name":"chocolate"}'</span> <span class="se">\</span>
https://your-service-url.execute-api.us-east-1.amazonaws.com/latest/icecreams
</code></pre>
</div>

<p>By running these commands you’ll see your service working!</p>

<p>That’s it!</p>

<h4 id="errors">Errors?</h4>
<p>In case of an error, please check your code if you haven’t missed anything. After an error, invoking the command again may show</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="s1">'Role with name ice-cream-shop-executor already exists.'</span>
</code></pre>
</div>

<p>In that case, go to your <a href="https://console.aws.amazon.com/iam">AWS Console IAM</a>, in the left bar- click <em>“Roles”</em> and find a role with the name error specified and delete it. Then try the previous claudia create command again.</p>

<h4 id="updating-yourservice">Updating your service</h4>
<p>If you want to redeploy to your Lambda with Claudia.js, now you need to do a claudia update instead of create . The full command would look like this:</p>

<p><code class="highlighter-rouge">claudia update</code></p>

<p>It doesn’t need all those configuration options like <code class="highlighter-rouge">create</code>, because it stores them locally for you. If its successful, it also returns the URL of your deployed service.</p>

<p>Now go, you deserve some ice cream!</p>

<p>The full code example is available on <a href="https://github.com/effortless-serverless/ice-cream-shop">this repository</a>.</p>

</article>


  <div class="share-page">
  Share this post!

  <div class="share-links">
    
      <a class="fa fa-facebook" href="https://facebook.com/sharer.php?u=https%3A%2F%2Feffortless-serverless.com%2Fserverless%2Flambda%2Fdynamodb%2F2017%2F10%2F19%2Fserverless-icecream-database%2F" rel="nofollow" target="_blank" title="Share on Facebook"></a>
    

    
      <a class="fa fa-twitter" href="https://twitter.com/intent/tweet?text=How+To+Create+a+Serverless+Node.js+App+with+DynamoDB+For+The+First+Time&amp;url=https%3A%2F%2Feffortless-serverless.com%2Fserverless%2Flambda%2Fdynamodb%2F2017%2F10%2F19%2Fserverless-icecream-database%2F" rel="nofollow" target="_blank" title="Share on Twitter"></a>
    

    

    
      <a class="fa fa-linkedin" href="http://www.linkedin.com/shareArticle?url=https%3A%2F%2Feffortless-serverless.com%2Fserverless%2Flambda%2Fdynamodb%2F2017%2F10%2F19%2Fserverless-icecream-database%2F&amp;title=How+To+Create+a+Serverless+Node.js+App+with+DynamoDB+For+The+First+Time" rel="nofollow" target="_blank" title="Share on LinkedIn"></a>
    

    

    

    

    

    
  </div>
</div>













      </div>
    </div>
  </div>

  <footer class="center">
  <div class="measure">
    <!-- Begin MailChimp Signup Form -->
    <div id="mc_embed_signup">
      <form action="//effortless-serverless.us16.list-manage.com/subscribe/post?u=02e5d97fcf3744f4c4be84f32&amp;id=cba378b8a9" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
        <div id="mc_embed_signup_scroll">
      	  <h2 id="subscribe-title">To get updates for upcoming content, sign up</h2>
          <div id="mce-responses" class="clear">
        		<div class="response" id="mce-error-response" style="display:none"></div>
        		<div class="response" id="mce-success-response" style="display:none"></div>
        	</div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
          <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_02e5d97fcf3744f4c4be84f32_cba378b8a9" tabindex="-1" value=""></div>
          <div class="mail-box">
            <div id="subscribe-group" class="mc-field-group">
            	<input type="email" value="" name="EMAIL" class="required email" placeholder="Email Address" id="mce-EMAIL">
              <input type="submit" value="Get Updates" name="subscribe" id="mc-embedded-subscribe" class="book-action-button"/>
            </div>
          </div>
        </div>
      </form>
    </div>

    <!--End mc_embed_signup-->
    <small>
      © Effortless Serverless, 2017<br>
      &lt;/&gt; follow us at <a href="https://github.com/effortless-serverless">GitHub</a>
    </small>
  </div>
</footer>


</body>
</html>
