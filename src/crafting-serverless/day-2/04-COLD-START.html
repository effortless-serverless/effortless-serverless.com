
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>04. Performance optimization - latency and cold starts Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc/page-toc.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-accordion/accordion.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="05-NO-LAMBDA.html" />
    
    
    <link rel="prev" href="03-BACKGROUND-PROCESSING.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../WARMUPS.html">
            
                <a href="../WARMUPS.html">
            
                    
                    Warmups
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../day-1/">
            
                <a href="../day-1/">
            
                    
                    Day 1
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../day-1/1-SETUP.html">
            
                <a href="../day-1/1-SETUP.html">
            
                    
                    01. Setup your AWS Account
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../day-1/2-LAMBDA.html">
            
                <a href="../day-1/2-LAMBDA.html">
            
                    
                    02. Serverless app with AWS Lambda
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../day-1/3-CLOUDFORMATION.html">
            
                <a href="../day-1/3-CLOUDFORMATION.html">
            
                    
                    03. CloudFormation Infra as Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../day-1/4-APIGW.html">
            
                <a href="../day-1/4-APIGW.html">
            
                    
                    04. APIs withs API Gateway
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../day-1/5-DEBUG.html">
            
                <a href="../day-1/5-DEBUG.html">
            
                    
                    05. Debugging serverless apps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../day-1/6-DYNAMODB.html">
            
                <a href="../day-1/6-DYNAMODB.html">
            
                    
                    06. DynamoDB a serverless database
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../day-1/7-TESTING.html">
            
                <a href="../day-1/7-TESTING.html">
            
                    
                    07. Designing Testable Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../day-1/8-CICD.html">
            
                <a href="../day-1/8-CICD.html">
            
                    
                    08. CI/CD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="../day-1/9-DEPLOYMENT.html">
            
                <a href="../day-1/9-DEPLOYMENT.html">
            
                    
                    09. Deployment preferences
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="./">
            
                <a href="./">
            
                    
                    Day 2
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="01-UPLOAD-RECEIPTS.html">
            
                <a href="01-UPLOAD-RECEIPTS.html">
            
                    
                    01. Upload receipts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="02-EXTRACT-RECEIPT-TEXT.html">
            
                <a href="02-EXTRACT-RECEIPT-TEXT.html">
            
                    
                    02. Extract receipt text
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="03-BACKGROUND-PROCESSING.html">
            
                <a href="03-BACKGROUND-PROCESSING.html">
            
                    
                    03. Performance optimization - background processing
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.4.4" data-path="04-COLD-START.html">
            
                <a href="04-COLD-START.html">
            
                    
                    04. Performance optimization - latency and cold starts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="05-NO-LAMBDA.html">
            
                <a href="05-NO-LAMBDA.html">
            
                    
                    05. Performance optimization - skip Lambdas
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="06-STREAMING.html">
            
                <a href="06-STREAMING.html">
            
                    
                    06. Serverless streaming patterns
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="07-ORCHESTRATION.html">
            
                <a href="07-ORCHESTRATION.html">
            
                    
                    07. Orchestration using Step functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="08-MIGRATION.html">
            
                <a href="08-MIGRATION.html">
            
                    
                    08. The Enterprise Migration Path to Serverless
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="09-WARDLEY-MAPS.html">
            
                <a href="09-WARDLEY-MAPS.html">
            
                    
                    09. Build or outsource - Designing a Serverless Architecture with Wardley Maps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="10-SERVERLESS-FOR-CFOS.html">
            
                <a href="10-SERVERLESS-FOR-CFOS.html">
            
                    
                    10. Business case for refactoring
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../CONCLUSION.html">
            
                <a href="../CONCLUSION.html">
            
                    
                    Conclusion
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >04. Performance optimization - latency and cold starts</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="performance-optimization-latency-and-cold-starts">Performance optimization: latency and cold starts</h1>
<p>Serverless applications are not slow. However, from the early days of serverless, one of the most dreadful terms in serverless is &quot;cold start.&quot;</p>
<p>There are still servers in serverless, but they are hidden in layers of abstractions and fully managed by cloud vendors. When we write code, all we care about are functions. In serverless, functions run in some kind of containers (or micro VMs in case of AWS Lambda). The first time our function is triggered in a while, a cloud vendor needs to start the container, and execution can take a bit longer. That&apos;s a cold start. Subsequent invocations will hit the same container, and customers will get their results faster. We call these warm starts.</p>
<p>How slow is a cold start?</p>
<p>The only correct answer is: it depends. As you can see, our app is not slow. The function execution is a couple of hundreds of milliseconds slower if we hit a cold start. However, it can be slower. For example, some runtimes have slower cold start than the others (Node.js and Python are faster than Java). It also depends on the size of our code. Smaller code bundles will start faster, and we want to keep the number of dependencies as low as we can. Finally, running a function in a virtual private cloud (VPC) increases the cold start time. It&apos;s not as slow as it were (10-15s), but it still takes a second or more to run a cold function.</p>
<p>Most of the time, our customers will not even notice cold starts. However, in some cases, speed is mission-critical, and we want to speed up our functions as much as we can.</p>
<p>Some hacks help with reducing cold starts. For example, we can set up a cron job that will keep our functions warm, but that approach has many downsides. Fortunately, AWS introduced <a href="https://aws.amazon.com/blogs/aws/new-provisioned-concurrency-for-lambda-functions/" target="_blank">Provisioned Concurrency</a> for AWS Lambda, a feature that keeps functions initialized and hyper-ready to respond in double-digit milliseconds.</p>
<h2 id="task">Task</h2>
<p>Your task is to add a Provisioned Concurrency to the Lambda function we use for saving receipts (one we created the first day). This will allow our customers to save expenses faster.</p>
<blockquote>
<p><strong>Note:</strong> Use Provisioned Concurrency for one function and one provisioned instance only, because of its cost. Provisioning one function for one day should not add more than a few cents to your monthly bill, but if we provision multiple instances cost will be higher.</p>
</blockquote>
<p>As a bonus, try to find a way to cache HTTP connection for DynamoDB table, so we can additionally improve app performance.</p>
<p>Once you complete this exercise, take a minute and discuss this solution with your team. Is the app faster after we added provisioned concurrency?</p>
<h2 id="hints">Hints</h2>
<p>Here are a few hints to help you with this task:</p>
<ul>
<li>AWS SAM supports Provisioned Concurrency, see the <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-function.html" target="_blank">AWS::Serverless::Function resource docs</a> for more details.</li>
<li>Provisioned Concurrency requires an alias, we can&apos;t set it for the <code>$LATEST</code> version of our function.</li>
<li>Provisioned Concurrency and Reserved Capacity are not the same. Make sure you read about main differences.</li>
<li>By default, the default Node.js HTTP/HTTPS agent creates a new TCP connection for every new request. To avoid the cost of establishing a new connection, you can reuse an existing connection. For more info see <a href="https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/node-reusing-connections.html" target="_blank">this guide</a>.</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="03-BACKGROUND-PROCESSING.html" class="navigation navigation-prev " aria-label="Previous page: 03. Performance optimization - background processing">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="05-NO-LAMBDA.html" class="navigation navigation-next " aria-label="Next page: 05. Performance optimization - skip Lambdas">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"04. Performance optimization - latency and cold starts","level":"1.4.4","depth":2,"next":{"title":"05. Performance optimization - skip Lambdas","level":"1.4.5","depth":2,"path":"day-2/05-NO-LAMBDA.md","ref":"day-2/05-NO-LAMBDA.md","articles":[]},"previous":{"title":"03. Performance optimization - background processing","level":"1.4.3","depth":2,"path":"day-2/03-BACKGROUND-PROCESSING.md","ref":"day-2/03-BACKGROUND-PROCESSING.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["page-toc","accordion"],"pluginsConfig":{"page-toc":{"selector":".markdown-section h1, .markdown-section h2, .markdown-section h3, .markdown-section h4","position":"before-first","showByDefault":true},"accordion":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"day-2/04-COLD-START.md","mtime":"2020-02-26T09:22:09.354Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-02-28T08:17:42.016Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-page-toc/anchor-3.1.1.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc/page-toc.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-accordion/accordionSelector.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

