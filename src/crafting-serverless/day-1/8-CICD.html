
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>08. CI/CD Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc/page-toc.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-accordion/accordion.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="9-DEPLOYMENT.html" />
    
    
    <link rel="prev" href="7-TESTING.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../WARMUPS.html">
            
                <a href="../WARMUPS.html">
            
                    
                    Warmups
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="./">
            
                <a href="./">
            
                    
                    Day 1
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="1-SETUP.html">
            
                <a href="1-SETUP.html">
            
                    
                    01. Setup your AWS Account
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="2-LAMBDA.html">
            
                <a href="2-LAMBDA.html">
            
                    
                    02. Serverless app with AWS Lambda
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="3-CLOUDFORMATION.html">
            
                <a href="3-CLOUDFORMATION.html">
            
                    
                    03. CloudFormation Infra as Code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="4-APIGW.html">
            
                <a href="4-APIGW.html">
            
                    
                    04. APIs withs API Gateway
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="5-DEBUG.html">
            
                <a href="5-DEBUG.html">
            
                    
                    05. Debugging serverless apps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="6-DYNAMODB.html">
            
                <a href="6-DYNAMODB.html">
            
                    
                    06. DynamoDB a serverless database
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="7-TESTING.html">
            
                <a href="7-TESTING.html">
            
                    
                    07. Designing Testable Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.8" data-path="8-CICD.html">
            
                <a href="8-CICD.html">
            
                    
                    08. CI/CD
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="9-DEPLOYMENT.html">
            
                <a href="9-DEPLOYMENT.html">
            
                    
                    09. Deployment preferences
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../day-2/">
            
                <a href="../day-2/">
            
                    
                    Day 2
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../day-2/01-UPLOAD-RECEIPTS.html">
            
                <a href="../day-2/01-UPLOAD-RECEIPTS.html">
            
                    
                    01. Upload receipts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../day-2/02-EXTRACT-RECEIPT-TEXT.html">
            
                <a href="../day-2/02-EXTRACT-RECEIPT-TEXT.html">
            
                    
                    02. Extract receipt text
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../day-2/03-BACKGROUND-PROCESSING.html">
            
                <a href="../day-2/03-BACKGROUND-PROCESSING.html">
            
                    
                    03. Performance optimization - background processing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../day-2/04-COLD-START.html">
            
                <a href="../day-2/04-COLD-START.html">
            
                    
                    04. Performance optimization - latency and cold starts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../day-2/05-NO-LAMBDA.html">
            
                <a href="../day-2/05-NO-LAMBDA.html">
            
                    
                    05. Performance optimization - skip Lambdas
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../day-2/06-STREAMING.html">
            
                <a href="../day-2/06-STREAMING.html">
            
                    
                    06. Serverless streaming patterns
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../day-2/07-ORCHESTRATION.html">
            
                <a href="../day-2/07-ORCHESTRATION.html">
            
                    
                    07. Orchestration using Step functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../day-2/08-MIGRATION.html">
            
                <a href="../day-2/08-MIGRATION.html">
            
                    
                    08. The Enterprise Migration Path to Serverless
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../day-2/09-WARDLEY-MAPS.html">
            
                <a href="../day-2/09-WARDLEY-MAPS.html">
            
                    
                    09. Build or outsource - Designing a Serverless Architecture with Wardley Maps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../day-2/10-SERVERLESS-FOR-CFOS.html">
            
                <a href="../day-2/10-SERVERLESS-FOR-CFOS.html">
            
                    
                    10. Business case for refactoring
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../CONCLUSION.html">
            
                <a href="../CONCLUSION.html">
            
                    
                    Conclusion
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >08. CI/CD</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="implementing-a-serverless-cicd-using-codepipeline-and-codebuild">Implementing a serverless CI/CD using CodePipeline and CodeBuild</h1>
<p>While we continued working on our Expenses Tracker serverless application, the &quot;Sauf Pompiers&quot; SARL decided it wants more engineers working on it, even though there (still!) arent too many engineers that know serverless applications very well. But, no problem, you will be their Lead and Mentor engineer.</p>
<p>Additionally, the &quot;Sauf Pompiers&quot; wants a streamlined development process, and if we take into account the bigger team coming to the project, it has become an imperative to setup a serverless CI/CD. We can&apos;t have a dozen engineers all deploying at the same time without any review process.</p>
<p>But where do we start with a serverless CI/CD?</p>
<p>Luckily, as we are using AWS, you are going to be happy to know it has quite a good continuous delivery system called AWS CodePipeline. With complete SAM support. It&apos;s main benefit being that authentication and tooling are easy to set up.</p>
<p>AWS CodePipeline, enables you to define a sequence of tasks that start from the source code and end up with a new version of the production system. Usually, the tasks will do something to the source code, such as run tests, produce application binaries or package artefacts, and each task can save the results so that another task can use them as input. AWS CodePipeline automatically moves artefacts between successful tasks. You can optionally set up manual approval steps requiring humans to verify release candidates. AWS CodePipeline runs build agents using AWS CodeBuild.</p>
<p>AWS CodeBuild is a service, almost identical to Jenkins, able to spin up Docker containers, where you can install development and testing tools, and then execute a defined sequence of system commands. You can either use one of the standard AWS containers, or pre-package your own. Standard containers usually come the AWS SDK installed, and with it also Python.</p>
<blockquote>
<p><strong>Note</strong> If you are using JavaScript for developing Lambda functions, it&#x2019;s safe to choose the provided Node.js container, and it will still have Python and the AWS toolkit.</p>
</blockquote>
<p>So the whole lifecycle is:</p>
<ol>
<li>AWS CodePipeline automatically triggers on new commits into version control (GitHub, AWS CodeCommit)</li>
<li>AWS CodeBuild follows a <code>buildspec.yml</code> file that defined how your application should be built. Common defaults for most languages &amp; dependency repositories. You are able to even have Custom Docker images.</li>
<li>CloudFormation does a transform of your SAM resources to known resources, executes a ChangeSet.</li>
<li>Run tests</li>
<li>Gate Keeper asks for Manual Approval (optional)</li>
</ol>
<h2 id="task">Task</h2>
<p>Your task now is to setup the whole step-by-step guide from above.</p>
<ol>
<li>Setup AWS CodePipeline and AWS CodeBuild. CodePipeline is to trigger on a version control update (its highly recommended to use GitHub).</li>
<li>Create a CodeBuild <code>buildspec.yml</code> file that will do a build of your codebase.</li>
<li>Setup the CloudFormation <code>pipeline.yml</code> stack for deployment.</li>
<li>Add a Manual approver step.</li>
<li>Run and enable it.</li>
</ol>
<h2 id="hints">Hints</h2>
<p>Here are a few hints to help you with this task, as this is a big one:</p>
<ol>
<li><p>If you haven&apos;t done this before, version this project as a GitHub or AWS CodeCommit repository.</p>
</li>
<li><p>Create an full fledge CodePipeline + CodeBuild solution by utilizing the <a href="https://github.com/aws-samples/cookiecutter-aws-sam-pipeline" target="_blank">AWS CodePipeline CookieCutter solution</a> and generate it. <strong>Note</strong>: Be sure to do it inside your project folder.
The reason why we are doing it using this, is because it&apos;s already a best practice setup provided by AWS.</p>
</li>
<li><p>Follow up on the generated <code>Pipeline Instructions.md</code>. Get the GitHub Access token, and setup your SSM parameters for the GitHub repository (repo, token, user)</p>
</li>
<li><p>Change the CodeBuild setup in the <code>buildspec.yml</code> per your language setup (again as per the <code>Pipeline Instructions.md</code>) - See which images are available <a href="https://docs.aws.amazon.com/codebuild/latest/userguide/build-env-ref-available.html" target="_blank">here</a></p>
</li>
<li><p>Follow up on the instructions and run the AWS CodePipeline by doing a test commit and push into your new GitHub repo.</p>
</li>
</ol>
<blockquote>
<p><strong>Note:</strong> If you have any issues or want to remove it, you can always do a CloudFormation delete stack operation: <code>aws cloudformation delete-stack --stack-name YOUR_STACK</code></p>
</blockquote>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="7-TESTING.html" class="navigation navigation-prev " aria-label="Previous page: 07. Designing Testable Functions">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="9-DEPLOYMENT.html" class="navigation navigation-next " aria-label="Next page: 09. Deployment preferences">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"08. CI/CD","level":"1.3.8","depth":2,"next":{"title":"09. Deployment preferences","level":"1.3.9","depth":2,"path":"day-1/9-DEPLOYMENT.md","ref":"day-1/9-DEPLOYMENT.md","articles":[]},"previous":{"title":"07. Designing Testable Functions","level":"1.3.7","depth":2,"path":"day-1/7-TESTING.md","ref":"day-1/7-TESTING.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["page-toc","accordion"],"pluginsConfig":{"page-toc":{"position":"before-first","selector":".markdown-section h1, .markdown-section h2, .markdown-section h3, .markdown-section h4","showByDefault":true},"accordion":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"day-1/8-CICD.md","mtime":"2020-02-26T13:25:31.399Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-02-26T22:03:57.845Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-page-toc/anchor-3.1.1.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc/page-toc.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-accordion/accordionSelector.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

